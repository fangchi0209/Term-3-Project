<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://apis.google.com/js/platform.js?onload=onLoad" async defer></script>
    <meta name="google-signin-client_id"
        content="807588094774-v7tcl63kqsj96r64gaqhtu8gsn81ffnt.apps.googleusercontent.com">
    <title>Events</title>
    <link rel="stylesheet" href="{{url_for('static',filename='css/base.css')}}">
</head>

<body>

    <style>
        body {
            background-color: #f0ebe5
        }

        #pageCover {
            position: relative;
            width: 100%;
            height: 580px;
            background-image: url("/eventCover.png");
            background-attachment: fixed;
            background-size: cover;
            margin-top: 150px;
        }

        #createEvents {
            position: absolute;
            left: 200px;
            background: white;
            opacity: 0.7;
            width: 380px;
            height: 380px;
        }

        #createSlogan {
            position: absolute;
            color: black;
            z-index: 2;
            left: 220px;
            padding: 40px 20px;
            line-height: 1.5;
            width: 300px;
            height: 200px;
            font-size: 32px;
            font-weight: bold;
        }

        #eArrow {
            color: black;
            font-size: 32px;
            width: 40px;
            position: absolute;
            left: 530px;
            bottom: 220px;
        }

        #createBtn {
            height: 160px;
            position: absolute;
            left: 580px;
            border: none;
            bottom: 100px;
            width: 160px;
            color: black;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer
        }

        #events {
            margin: auto;
            display: flex;
            flex-direction: row;
        }


        #ownEvents {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            width: 1400px;
            justify-content: center;
            margin: 20px auto;
        }


        .indiEvent {
            display: flex;
            flex-direction: column;
            width: 370px;
            margin: 20px 30px;
            height: 275px;
            background-color: white;
            border-bottom: 1px solid #c5b8a5;
        }

        .indiEvent:hover {
            box-shadow: 1px 1px 10px;
        }

        .indiCover {
            width: 100%;
            height: 165px;
            background-size: cover;
            background-repeat: no-repeat;
        }

        .indiInfo {
            display: flex;
            flex-direction: column;
            padding: 10px 20px 0px 20px;
        }

        .indiTitle {
            font-size: 20px;
            color: #656565;
        }

        .indiOrg {
            color: #8696a7;
            line-height: 2;
            font-size: 15px;
        }

        .indiTime {
            color: #965454;
            font-size: 15px;
        }

        .indiDes {
            font-weight: 600;
            margin: 10px 0px;
        }

        #createpopup {
            position: fixed;
            width: 700px;
            height: 400px;
            left: 50%;
            top: 80px;
            transform: translateX(-50%);
            box-shadow: 0px 4px 60px black;
            z-index: 999;
            background-color: white;
            border-radius: 20px;
            font-size: 24px;
        }

        #cBox {
            overflow: auto;
            margin: 20px;
            height: 350px;
        }

        #eInfo {
            display: flex;
            flex-direction: column;
        }

        .eventinput {
            height: 70px;
            margin-left: 20px;
            width: 500px;
            border-radius: 8px;
            border: 1px solid gray;
            padding-left: 15px;
            font-size: 24px;
        }

        .createInfoBox {
            display: flex;
            flex-direction: row;
            margin: 20px 0px 0px 0px;
            align-items: center;
        }

        .eventDT {
            font-size: 24px;
            width: 210px;
            height: 70px;
            margin-left: 30px;
            border-radius: 8px;
            border: 1px solid gray;
            padding-left: 30px;
        }

        .cTitle {
            color: #030305;
            font-size: 24px;
        }


        #eventDes {
            border: 1px solid gray;
            border-radius: 8px;
            background-color: white;
            min-height: 90px;
            color: #030305;
            outline: none;
            font-size: 20px;
            padding: 20px;
        }

        #photoTogether {
            display: flex;
            flex-direction: row;
            margin-bottom: 10px;
        }

        #showimg {
            width: 300px;
        }

        input[type="file"] {
            display: none;
        }

        #nextBtn {
            position: absolute;
            width: 100px;
            height: 50px;
            bottom: 25px;
            right: 40px;
            color: white;
            background-color: #c5b8a5;
            border: 1px solid #c5b8a5;
            border-radius: 8px;
            font-family: Helvetica;
            font-size: 28px;
            cursor: pointer;
        }

        #nextBtn:hover {
            background-color: white;
            color: black;
        }

        #launchSec {
            display: flex;
            flex-direction: row;
            margin-top: 10px;
            justify-content: flex-end;
        }

        #launchBtn {
            width: 100px;
            height: 50px;
            color: white;
            background-color: #c5b8a5;
            border: 1px solid #c5b8a5;
            border-radius: 8px;
            font-family: Helvetica;
            font-size: 28px;
            cursor: pointer;
        }

        #launchBtn:hover {
            background-color: white;
            color: black;
        }

        #previousBtn {
            width: 130px;
            height: 48px;
            font-size: 28px;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            margin-right: 10px;
        }

        #previousBtn:hover {
            border: 1px solid gray;
            border-radius: 8px;
        }

        .fa-user-cog {
            margin-left: -30px;
        }

        .sBox {
            width: 650px;
            margin-top: 80px;
        }
    </style>
    <div class="searchEngine">
        <div class="Header">
            <a href="/">BooKÏ</a>
        </div>

        <div class="nav">
            <div class="menu"><a id="eventPage" href="/events">Events</a></div>
            <!-- <div class="menu mybookIcon" id="mybookIcon"><a id="mybookProcess" class="mybookProcess" href="#"><i
                        class="fas fa-book"></i></a></div> -->
            <div class="menu signinIcon" id="signinIcon" style="display: none"><a id="signinProcess"
                    class="signinProcess" href="/accounts">Sign in</a></div>
            <div class="menu signoutIcon" id="signoutIcon" style="display: none"><a id="signoutProcess"
                    class="signoutProcess" href="#"><i class="fas fa-user-astronaut"></i></a></div>
        </div>
    </div>

    <div id="pageCover">
        <div id="createEvents"></div>
        <div id="createSlogan">To Create The Best Online Events Without Leaving Home</div>
        <div id="eArrow"><i class="fas fa-arrow-right"></i></div>
        <button id="createBtn">Create Now</button>
    </div>

    <!-- <button id="changecolour">change</button> -->

    <div id="events">
        <div id="ownEvents" class="eventBox">
        </div>
        <div id="outerEvents" class="eventBox" style="display: none">
            outer
        </div>
        <div id="fairs" class="eventBox" style="display: none">
            fairs
        </div>
    </div>

    <label><a id="bgBtn" href="javascript:void(0)">
            <div id="bg" class="bg"></div>
        </a></label>

    <div id="createpopup" style="display: none;">
        <div id="cBox" style="display: none;">
            <div id="eInfo1" class="eInfo">
                <div class="createInfoBox">
                    <div class="cTitle">Event Title:</div>
                    <input type="text" id="eventName" class="eventinput" placeholder="BooKÏ Top 10 club">
                </div>
                <div class="createInfoBox">
                    <div class="cTitle">Start time:</div>
                    <input type="date" id="sDate" class="eventDT"><input type="time" id="sTime" class="eventDT">
                    <!-- <div class="eventT">
                        <div class="cTitle">End time:</div><input type="date" id="eDate" class="eventDT"
                            style="margin-left: 35px"><input type="time" id="eTime" class="eventDT">
                    </div> -->
                </div>
                <div class="createInfoBox">
                    <div class="cTitle">Event Link:</div>
                    <input type="text" id="virtual" class="eventinput" placeholder="http://">
                </div>
                <button id="nextBtn">Next</button>
            </div>

            <div id="eInfo2" class="eInfo" style="display: none">
                <div id="photoTogether">
                    <label for="eventImg" class="custom-file-upload">
                        <i class="fa fa-cloud-upload"></i> Upload
                    </label>
                    <input type="file" name="photo" id="eventImg" onchange="showImg(this)">
                    <img id="showimg" src="" style="display:none;" />
                </div>

                <div class="cTitle">Event Description:</div>
                <div contenteditable="true" id="eventDes" data-placeholder="Event description"></div>
                <div id="launchSec">
                    <button id="previousBtn" style="display: none">Previous</button>
                    <button id="launchBtn" onclick="launchEvent(event)" style="display: none">Send</button>
                </div>
            </div>

        </div>


        <div id="sBox" class="sBox" style="display: none">
            <i class="fas fa-user-cog"></i><br>
            <div style=>Sign in with your BooKÏ Account to create an event</div>
            <button id="cancelBtn" class="cancelBtn">cancel</button><button id="gosigninBtn" class="gosigninBtn"
                onclick="goSignin()">Sign in</button>
        </div>
    </div>


    <script src="https://kit.fontawesome.com/cbebce4b6d.js" crossorigin="anonymous"></script>
    <script src="{{url_for('static',filename='js/base.js')}}"></script>

    <script>
        //MAIN SCRIPT

        showEvents()

        let createBtn = document.getElementById("createBtn")
        let bg = document.getElementById("bg")
        let bgBtn = document.getElementById("bgBtn")
        let nextBtn = document.getElementById("nextBtn")
        let eInfo1 = document.getElementById("eInfo1")
        let eInfo2 = document.getElementById("eInfo2")
        let previousBtn = document.getElementById("previousBtn")
        let launchBtn = document.getElementById("launchBtn")
        let eventName = document.getElementById("eventName")
        let sDate = document.getElementById("sDate")
        let sTime = document.getElementById("sTime")
        let virtual = document.getElementById("virtual")
        let createpopup = document.getElementById("createpopup")
        let cBox = document.getElementById("cBox")
        let sBox = document.getElementById("sBox")
        let cancelBtn = document.getElementById("cancelBtn")

        var today = new Date().toISOString().split('T')[0];
        sDate.setAttribute('min', today);

        bgBtn.addEventListener("click", function () {
            bg.style.display = "none";
            document.getElementById("createpopup").style.display = "none"
            cBox.style.display = "none"
            eInfo1.style.display = "block"
            eInfo2.style.display = "none"
            previousBtn.style.display = "none"
            nextBtn.style.display = "block"
            launchBtn.style.display = "none"
            sBox.style.display = "none"
            return false;
        })

        createBtn.addEventListener("click", function () {
            if (document.getElementById("signinIcon").style.display == "block") {
                createpopup.style.display = "block"
                createpopup.style.backgroundColor = "#D3D3D3"
                cBox.style.display = "none"
                sBox.style.display = "block"
                bg.style.display = "block"
            } else {
                bg.style.display = "block";
                createpopup.style.display = "block"
                createpopup.style.backgroundColor = "white"
                cBox.style.display = "block"
                sBox.style.display = "none"
            }

        })

        nextBtn.addEventListener("click", function () {
            eInfo1.style.display = "none"
            eInfo2.style.display = "block"
            previousBtn.style.display = "block"
            nextBtn.style.display = "none"
            launchBtn.style.display = "block"
        })

        previousBtn.addEventListener("click", function () {
            eInfo1.style.display = "block"
            eInfo2.style.display = "none"
            previousBtn.style.display = "none"
            nextBtn.style.display = "block"
            launchBtn.style.display = "none"
        })

        cancelBtn.addEventListener("click", function () {
            bg.style.display = "none";
            createpopup.style.display = "none";
            sBox.style.display = "none"
        })

        function showImg(thisimg) {
            var file = thisimg.files[0];
            if (window.FileReader) {
                var fr = new FileReader();

                var showimg = document.getElementById('showimg');
                fr.onloadend = function (e) {
                    showimg.src = e.target.result;
                };
                fr.readAsDataURL(file);
                showimg.style.display = 'block';
            }
        }

        function goSignin() {
            window.location.replace("/accounts")
        }

        async function launchEvent() {

            let selectedFile = document.getElementById('eventImg').files[0];
            let s;

            if (selectedFile == null || sDate.value == null || sTime.value == null || eventName.value == null || virtual.value == null) {
                alert("Please fill the blanks")
                return
            } else {

                let date1 = new Date(sDate.value)
                let sday = date1.getDay()
                if (sday === 0) {
                    sday = "Sun"
                } else if (sday === 1) {
                    sday = "Mon"
                } else if (sday === 2) {
                    sday = "Tue"
                } else if (sday === 3) {
                    sday = "Wed"
                } else if (sday === 4) {
                    sday = "Thur"
                } else if (sday === 5) {
                    sday = "Fri"
                } else {
                    sday = "Sat"
                }

                let smonth;
                date1.getMonth() + 1 < 10 ? smonth = date1.getMonth() + 1 : smonth = date1.getMonth()

                if (smonth === 1) {
                    smonth = "Jan"
                } else if (smonth === 2) {
                    smonth = "Feb"
                } else if (smonth === 3) {
                    smonth = "Mar"
                } else if (smonth === 4) {
                    smonth = "Apr"
                } else if (smonth === 5) {
                    smonth = "May"
                } else if (smonth === 6) {
                    smonth = "Jun"
                } else if (smonth === 7) {
                    smonth = "Jul"
                } else if (smonth === 8) {
                    smonth = "Aug"
                } else if (smonth === 9) {
                    smonth = "Sep"
                } else if (smonth === 10) {
                    smonth = "Oct"
                } else if (smonth === 11) {
                    smonth = "Nov"
                } else {
                    smonth = "Dec"
                }

                let sdate = date1.getDate()
                let syear = date1.getFullYear()

                s = [sday, sdate, smonth, syear]
            }

            let formData = new FormData()
            formData.append('eTitle', eventName.value)
            formData.append('sDate', s)
            formData.append('sTime', sTime.value)
            formData.append('online', virtual.value)
            formData.append('selectFile', selectedFile);
            formData.append('description', eventDes.innerHTML)

            await fetch("/api/bookievents", {
                method: "POST",
                body: formData,
            }).then(response => {
                return response.json()
            }).then(re => {
                location.reload()
            })
        }

        async function showEvents() {
            await fetch("/api/bookievents", { method: "GET" })
                .then(response => {
                    return response.json()
                }).then(data => {
                    eventsAll = data.allEvents

                    for (let i = 0; i < eventsAll.length; i++) {
                        let ownEvents = document.getElementById("ownEvents")
                        let indiEvent = document.createElement("div")
                        let img_tag = document.createElement("div")
                        let indiInfo = document.createElement("div")
                        let indiTitle = document.createElement("div")
                        let indiTime = document.createElement("div")
                        let a_tag = document.createElement("a")
                        let indiOrg = document.createElement("div")


                        indiEvent.classList.add("indiEvent")
                        img_tag.classList.add("indiCover")
                        indiInfo.classList.add("indiInfo")
                        indiTitle.classList.add("indiTitle")
                        indiTime.classList.add("indiTime")
                        a_tag.classList.add("indiLink")
                        indiOrg.classList.add("indiOrg")

                        indiTitle.innerHTML = eventsAll[i].aTitle
                        indiOrg.innerHTML = "by " + eventsAll[i].aUser.toUpperCase()
                        img_tag.style.backgroundImage = `url(${eventsAll[i].aCover})`
                        indiTime.innerHTML = eventsAll[i].asDay + ", " + eventsAll[i].asDate + ", " + eventsAll[i].asMonth + ", " + eventsAll[i].asYear + ", " + eventsAll[i].asTime
                        a_tag.href = `/e/${eventsAll[i].aTitle}`

                        indiInfo.appendChild(indiTitle)
                        indiInfo.appendChild(indiOrg)
                        indiInfo.appendChild(indiTime)
                        a_tag.appendChild(img_tag)
                        a_tag.appendChild(indiInfo)
                        indiEvent.appendChild(a_tag)
                        ownEvents.appendChild(indiEvent)

                    }
                })
        }



    </script>

    <script>
        //MEMBER SYSTEM

        checkProcess()

        async function checkProcess() {
            await fetch("/api/user", { method: "GET" })
                .then(response => {
                    return response.json()
                }).then(res => {
                    if (res.data == true) {
                        signinIcon.style.display = "none"
                        signoutIcon.style.display = "block"
                    } else {
                        signinIcon.style.display = "block"
                        signoutIcon.style.display = "none"
                    }
                })
        }

        document.getElementById("signoutProcess").addEventListener("click", function () {
            logoutProcess()
            signOut()
        })


        function onLoad() {
            gapi.load('auth2', function () {
                gapi.auth2.init();
            });
        }

        async function logoutProcess() {
            var auth2 = gapi.auth2.getAuthInstance();
            auth2.signOut().then(function () {
                console.log('User signed out.');
            });
            await fetch("/api/user", {
                method: "DELETE",
                headers: {
                    "content-type": "application/json"
                },
            }).then(response => {
                return response.json()
            }).then(result => {
                if (result.ok == true) {
                    location.reload()
                }
            })
        }
    </script>
</body>

</html>